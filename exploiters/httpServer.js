const fs = require('fs');
const net = require('net');
const path = require('path');
const Response = require('./response');

// const takeStatus = (text) => {
//   const STATUS_REGEX = /^HTTP\/1.1 (\d{3})/;
//   const match = STATUS_REGEX.match(text);
//   return match[0];
// };

const server = net.createServer((socket) => {
  socket.on('data', (data) => {
    console.log(data.toString());
    fs.readFile(path.join(__dirname, 'googleRes'), (err) => {
      const response = new Response('\n<h1 data-testid="server">Protocolos</h1>');
      if (err) return console.log('\u001b[31m', err, '\u001b[0m');
      const show = response.show();
      socket.write(show);
      socket.end();
    });
  });
});

const { PORT = 3000 } = process.env;

server.listen(PORT, () => console.log(`Ouvindo na porta ${PORT}`));
